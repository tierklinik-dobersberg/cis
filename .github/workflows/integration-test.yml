name: integration-tests
on: push
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-go@v2
      - name: Building cisd
        run: cd integration && docker-compose build cisd
      - name: Setup environment
        run: cd integration && docker-compose up -d
      - name: Run Jasmine tests
        run: cd spec && npm install && CI=true npm test || ( cd integration ; docker-compose logs cisd ; exit -1 )
      - name: Teardown environment
        run: cd integration && docker-compose down