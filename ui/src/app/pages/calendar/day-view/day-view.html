<div class="flex justify-between items-center -mb-3" [ngClass]="{'p-2': !inlineView, 'pb-2': inlineView}">
    <div>
        <nz-button-group>
            <button nz-button (click)="prevDay()" nzType="text">
                <i nz-icon nzType="left" nzTheme="outline"></i>
            </button>
            <nz-date-picker [nzAllowClear]="false" [(ngModel)]="date"></nz-date-picker>
            <button nz-button (click)="nextDay()" nzType="text">
                <i nz-icon nzType="right" nzTheme="outline"></i>
            </button>
        </nz-button-group>
    </div>

    <div>
        <nz-button-group>
            <button nz-button nzType="default" (click)="toggleAll()">
                {{ calendarModeText[calendarMode] }}
            </button>

            <button nz-button nzType="default" nz-dropdown [nzDropdownMenu]="dropdown" [nzClickHide]="false">
                <i nz-icon nzType="table" nzTheme="outline"></i>
            </button>
        </nz-button-group>

        <nz-dropdown-menu #dropdown="nzDropdownMenu">
            <ul nz-menu>
                <li nz-menu-item *ngFor="let cal of calendars; trackBy: trackCalendar" (click)="updateFilter(cal)"
                    (dblclick)="onFilterDblClick(cal)">
                    <i [style.opacity]="cal.displayed ? 1 : 0" nz-icon nzType="check" nzTheme="outline"></i>
                    {{ cal.name }}
                </li>
            </ul>
        </nz-dropdown-menu>

        <!--
        <button class="create" nz-button nzType="primary" routerLink="/create-event">
            Neuer Termin
        </button>
    -->
    </div>
</div>

<div class="flex overflow-hidden flex-col flex-grow" 
    [ngClass]="{'bg-white rounded shadow p-2 md:p-4': !inlineView, 'mt-2': inlineView}">
    <div class="flex">
        <ng-container *ngFor="let cal of calendars; trackBy: trackCalendar; let last=last">
            <div class="flex flex-col justify-start w-full" *ngIf="cal.displayed">
                <div class="flex-1 flex-grow flex-shrink">
                    <div class="overflow-hidden w-full header text-ellipsis" (dblclick)="onFilterDblClick(cal)">
                        {{ cal.user?.fullname || cal.user?.name || cal.name }}
                    </div>
                </div>
            </div>
        </ng-container>
    </div>

    <div class="flex overflow-auto relative flex-grow" cdkScrollable #scrollContainer>
        <div id="height-wrapper" class="absolute top-0"></div>
        <div class="calendar" *ngIf="!calendars?.length && !loading">
            <div class="bg-opacity-10 times bg-text-deEmphasized">
                <div class="relative w-full bg-white opening-hour" *ngFor="let oh of openingHours;"
                    [ngStyle]="{top: oh.y, height: oh.height}">
                </div>
                <div class="hours">
                    <div *ngFor="let hour of hours" [ngStyle]="{height: hourHeight}">
                        <caption>{{hour < 10 ? '0' + hour : hour}}:00</caption>
                    </div>
                </div>
            </div>
        </div>

        <ng-container *ngIf="!loading">
            <ng-container *ngFor="let cal of calendars; trackBy: trackCalendar; let last=last">
                <div class="flex flex-col justify-start items-stretch w-full" *ngIf="cal.displayed">
                    <div class="calendar">
                        <div class="bg-opacity-10 times bg-text-deEmphasized" (dblclick)="createEvent($event, cal)">
                            <div class="absolute w-full bg-white opening-hour" *ngFor="let oh of openingHours;"
                                [ngStyle]="{top: oh.y, height: oh.height}"></div>

                            <div class="hours">
                                <div *ngFor="let hour of hours" [ngStyle]="{height: hourHeight + 'px'}">
                                    <caption>{{hour < 10 ? '0' + hour : hour}}:00</caption>
                                </div>
                            </div>

                            <span class="event" *ngFor="let event of cal.events; trackBy: trackEvent"
                                [class.inactive]="activeEventID !== ''" (click)="onEventActivate(event)"
                                [class.active]="activeEventID === event._id"
                                [ngStyle]="{top: (event.top +  event.offsettop) + 'px', 'min-height': event.height + 'px', height: event.height + 'px', left: event.left + 'px', right: '0px', backgroundColor: event.color, color: event.fontColor}">
                                {{ event.startTime | date:'HH:mm'}}
                                {{ event.summary }}
                                <ng-container *ngIf="activeEventID === event._id">
                                    <br />
                                    {{ event.description }}
                                </ng-container>
                            </span>
                        </div>
                    </div>
                </div>
            </ng-container>
        </ng-container>


        <div class="absolute w-full border-t-2 border-opacity-75 current-time border-alert-red" *ngIf="isToday"
            [ngStyle]="{top: todayOffset + 'px', left: scrollable.nativeElement.scrollLeft}">
            <span class="relative text-white bg-opacity-75 bg-alert-red">
                {{ currentTime | date:'HH:mm' }}
            </span>
        </div>
    </div>
</div>