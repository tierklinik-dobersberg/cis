<div hlmCardHeader>
  <h3 hlmCardTitle>Letzte DICOM Studien</h3>
</div>

<div
  hlmCardContent
  class="flex max-h-[200px] flex-grow flex-col overflow-auto p-2 !pt-0 md:p-4 lg:p-6">
  <hlm-table>
    @for (study of studies(); track study.studyUid) {
      <hlm-trow>
        <hlm-td class="flex-1 flex-row gap-2">
          <span class="flex flex-col items-start justify-start text-gray-400">
            @if (study.time | toDate; as date) {
              <span>
                {{ date | date: 'shortDate' }}
              </span>
              <span>
                {{ date | date: 'shortTime' }}
              </span>
            }
          </span>

          <span class="flex flex-col items-start justify-start">
            <span class="font-medium">{{ study.ownerName || 'N/A' }}</span>
            <span>
              {{ study.patientName || 'N/A' }}
            </span>
          </span>
        </hlm-td>

        <hlm-td class="flex flex-row gap-2">
          @if (study.previewUrls?.length) {
            @if (!layout.md()) {
              <img
                [attr.src]="study.previewUrls[0].url + '?viewport=70,70'"
                (click)="openStudy(study)"
                class="aspect-square min-h-12 w-12 cursor-pointer" />
            } @else {
              @for (url of study.previewUrls; track url.uid) {
                <brn-hover-card>
                  <img
                    brnHoverCardTrigger
                    [attr.src]="url.url + '?viewport=70,70'"
                    (click)="openStudy(study, url.uid)"
                    class="aspect-square min-h-12 w-12 cursor-pointer" />

                  <hlm-hover-card-content *brnHoverCardContent class="w-96">
                    <img
                      brnHoverCardTrigger
                      [attr.src]="url.url + '?viewport=400,400'"
                      class="aspect-square min-h-12 w-12 cursor-pointer" />
                  </hlm-hover-card-content>
                </brn-hover-card>
              }
            }
          }
        </hlm-td>
      </hlm-trow>
    }
  </hlm-table>
</div>
